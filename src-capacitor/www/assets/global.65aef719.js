import{P as o}from"./index.f99b5f9f.js";import{api as s}from"./axios.4d33b3f1.js";const n=o("useGlobalStore",{persist:{storage:window.sessionStorage},state:()=>({usersList:[],userName:null,customersList:[],customer:null,aedocument:null,aeinfo:null,token:null,photoList:[]}),getters:{},actions:{async getAllusers(){try{const t=await s.get("/users/all");this.usersList=t.data}catch(t){return t.response.data.error}},async postLogIn(t){try{const e=await s.post("/users/login",t);sessionStorage.setItem("token",e.data.token),this.setHeaders(),this.router.push("/customers")}catch(e){return e.response.data.error}},setHeaders(){this.token=sessionStorage.getItem("token"),s.defaults.headers.common.Authorization=this.token},logOut(){sessionStorage.clear(),this.token=null,s.defaults.headers.common.Authorization=null,this.usersList=[],this.userName=null,this.customersList=[],this.customer=null,this.aedocument=null,this.aeinfo=null,this.photoList=[],this.router.push("/")},async getAllCustomers(){try{this.setHeaders();const t=await s.get("/customers/all");this.customersList=t.data}catch(t){return t.response.data.error}},setCustomer(t){this.customer=t,this.router.push("/documents")},async getDeliveryInfo(t){try{this.setHeaders();const e=await s.get("/delivery",{params:t});this.aeinfo=e.data,this.router.push("/readings")}catch(e){return e.response.data.error}},async uploadUnit(t){try{this.setHeaders();const e=await s.put("/upload",t);this.aeinfo.lecturas.map(r=>{r.Descripcion===t.ud&&(r.NroDS=!0)})}catch(e){return e.response.data.error}},async downloadUnit(t){try{this.setHeaders();const e=await s.put("/download",t);this.aeinfo.lecturas.map(r=>{r.Descripcion===t.ud&&(r.NroDS=null)})}catch(e){return e.response.data.error}},async changeAE(){if(await this.getPhotos(),this.aeinfo.lecturas.filter(e=>e.NroDS===!0).length>=1&&this.photoList.length<1)return{msg:"Haz una foto"};this.router.push("/documents")},async uploadPhoto(t){try{this.setHeaders(),await s.post("/postphoto",{customer:this.customer,aedocument:this.aedocument,photo:t})}catch(e){return e.response.data.error}},async getPhotos(){try{if(this.setHeaders(),this.photoList=[],this.aedocument){const t=await s.get("/getphotos",{params:{ae:this.aedocument}});let e=1;for(let r=0;r<t.data.length;r++)this.photoList.push({id:e,src:"http://172.18.10.150:4002/"+this.aedocument+"/"+t.data[r]}),e++}}catch(t){return t.response.data.error}}}});export{n as u};

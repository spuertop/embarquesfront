import { aC as WebPlugin, aD as CapacitorException } from "./index.af93674c.js";
import { C as CameraSource, a as CameraDirection } from "./PhotoPage.d573b398.js";
import "./QPageSticky.662bbd1b.js";
import "./global.202de1e2.js";
import "./axios.91ad12ec.js";
import "./QInput.1a8b15d7.js";
import "./format.801e7424.js";
import "./selection.f6fbe71f.js";
import "./QPage.01bdf203.js";
class CameraWeb extends WebPlugin {
  async getPhoto(options) {
    return new Promise(async (resolve, reject) => {
      if (options.webUseInput || options.source === CameraSource.Photos) {
        this.fileInputExperience(options, resolve);
      } else if (options.source === CameraSource.Prompt) {
        let actionSheet = document.querySelector("pwa-action-sheet");
        if (!actionSheet) {
          actionSheet = document.createElement("pwa-action-sheet");
          document.body.appendChild(actionSheet);
        }
        actionSheet.header = options.promptLabelHeader || "Photo";
        actionSheet.cancelable = false;
        actionSheet.options = [
          { title: options.promptLabelPhoto || "From Photos" },
          { title: options.promptLabelPicture || "Take Picture" }
        ];
        actionSheet.addEventListener("onSelection", async (e) => {
          const selection = e.detail;
          if (selection === 0) {
            this.fileInputExperience(options, resolve);
          } else {
            this.cameraExperience(options, resolve, reject);
          }
        });
      } else {
        this.cameraExperience(options, resolve, reject);
      }
    });
  }
  async pickImages(_options) {
    return new Promise(async (resolve) => {
      this.multipleFileInputExperience(resolve);
    });
  }
  async cameraExperience(options, resolve, reject) {
    if (customElements.get("pwa-camera-modal")) {
      const cameraModal = document.createElement("pwa-camera-modal");
      cameraModal.facingMode = options.direction === CameraDirection.Front ? "user" : "environment";
      document.body.appendChild(cameraModal);
      try {
        await cameraModal.componentOnReady();
        cameraModal.addEventListener("onPhoto", async (e) => {
          const photo = e.detail;
          if (photo === null) {
            reject(new CapacitorException("User cancelled photos app"));
          } else if (photo instanceof Error) {
            reject(photo);
          } else {
            resolve(await this._getCameraPhoto(photo, options));
          }
          cameraModal.dismiss();
          document.body.removeChild(cameraModal);
        });
        cameraModal.present();
      } catch (e) {
        this.fileInputExperience(options, resolve);
      }
    } else {
      console.error(`Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.`);
      this.fileInputExperience(options, resolve);
    }
  }
  fileInputExperience(options, resolve) {
    let input = document.querySelector("#_capacitor-camera-input");
    const cleanup = () => {
      var _a;
      (_a = input.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(input);
    };
    if (!input) {
      input = document.createElement("input");
      input.id = "_capacitor-camera-input";
      input.type = "file";
      input.hidden = true;
      document.body.appendChild(input);
      input.addEventListener("change", (_e) => {
        const file = input.files[0];
        let format = "jpeg";
        if (file.type === "image/png") {
          format = "png";
        } else if (file.type === "image/gif") {
          format = "gif";
        }
        if (options.resultType === "dataUrl" || options.resultType === "base64") {
          const reader = new FileReader();
          reader.addEventListener("load", () => {
            if (options.resultType === "dataUrl") {
              resolve({
                dataUrl: reader.result,
                format
              });
            } else if (options.resultType === "base64") {
              const b64 = reader.result.split(",")[1];
              resolve({
                base64String: b64,
                format
              });
            }
            cleanup();
          });
          reader.readAsDataURL(file);
        } else {
          resolve({
            webPath: URL.createObjectURL(file),
            format
          });
          cleanup();
        }
      });
    }
    input.accept = "image/*";
    input.capture = true;
    if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {
      input.removeAttribute("capture");
    } else if (options.direction === CameraDirection.Front) {
      input.capture = "user";
    } else if (options.direction === CameraDirection.Rear) {
      input.capture = "environment";
    }
    input.click();
  }
  multipleFileInputExperience(resolve) {
    let input = document.querySelector("#_capacitor-camera-input-multiple");
    const cleanup = () => {
      var _a;
      (_a = input.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(input);
    };
    if (!input) {
      input = document.createElement("input");
      input.id = "_capacitor-camera-input-multiple";
      input.type = "file";
      input.hidden = true;
      input.multiple = true;
      document.body.appendChild(input);
      input.addEventListener("change", (_e) => {
        const photos = [];
        for (let i = 0; i < input.files.length; i++) {
          const file = input.files[i];
          let format = "jpeg";
          if (file.type === "image/png") {
            format = "png";
          } else if (file.type === "image/gif") {
            format = "gif";
          }
          photos.push({
            webPath: URL.createObjectURL(file),
            format
          });
        }
        resolve({ photos });
        cleanup();
      });
    }
    input.accept = "image/*";
    input.click();
  }
  _getCameraPhoto(photo, options) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      const format = photo.type.split("/")[1];
      if (options.resultType === "uri") {
        resolve({
          webPath: URL.createObjectURL(photo),
          format,
          saved: false
        });
      } else {
        reader.readAsDataURL(photo);
        reader.onloadend = () => {
          const r = reader.result;
          if (options.resultType === "dataUrl") {
            resolve({
              dataUrl: r,
              format,
              saved: false
            });
          } else {
            resolve({
              base64String: r.split(",")[1],
              format,
              saved: false
            });
          }
        };
        reader.onerror = (e) => {
          reject(e);
        };
      }
    });
  }
  async checkPermissions() {
    if (typeof navigator === "undefined" || !navigator.permissions) {
      throw this.unavailable("Permissions API not available in this browser");
    }
    try {
      const permission = await window.navigator.permissions.query({
        name: "camera"
      });
      return {
        camera: permission.state,
        photos: "granted"
      };
    } catch (_a) {
      throw this.unavailable("Camera permissions are not available in this browser");
    }
  }
  async requestPermissions() {
    throw this.unimplemented("Not implemented on web.");
  }
}
const Camera = new CameraWeb();
export { Camera, CameraWeb };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLjIwMjA4YzY4LmpzIiwic291cmNlcyI6WyIuLi8uLi9ub2RlX21vZHVsZXMvQGNhcGFjaXRvci9jYW1lcmEvZGlzdC9lc20vd2ViLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFdlYlBsdWdpbiwgQ2FwYWNpdG9yRXhjZXB0aW9uIH0gZnJvbSAnQGNhcGFjaXRvci9jb3JlJztcbmltcG9ydCB7IENhbWVyYVNvdXJjZSwgQ2FtZXJhRGlyZWN0aW9uIH0gZnJvbSAnLi9kZWZpbml0aW9ucyc7XG5leHBvcnQgY2xhc3MgQ2FtZXJhV2ViIGV4dGVuZHMgV2ViUGx1Z2luIHtcbiAgICBhc3luYyBnZXRQaG90byhvcHRpb25zKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1hc3luYy1wcm9taXNlLWV4ZWN1dG9yXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy53ZWJVc2VJbnB1dCB8fCBvcHRpb25zLnNvdXJjZSA9PT0gQ2FtZXJhU291cmNlLlBob3Rvcykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUlucHV0RXhwZXJpZW5jZShvcHRpb25zLCByZXNvbHZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG9wdGlvbnMuc291cmNlID09PSBDYW1lcmFTb3VyY2UuUHJvbXB0KSB7XG4gICAgICAgICAgICAgICAgbGV0IGFjdGlvblNoZWV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigncHdhLWFjdGlvbi1zaGVldCcpO1xuICAgICAgICAgICAgICAgIGlmICghYWN0aW9uU2hlZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uU2hlZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwd2EtYWN0aW9uLXNoZWV0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYWN0aW9uU2hlZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhY3Rpb25TaGVldC5oZWFkZXIgPSBvcHRpb25zLnByb21wdExhYmVsSGVhZGVyIHx8ICdQaG90byc7XG4gICAgICAgICAgICAgICAgYWN0aW9uU2hlZXQuY2FuY2VsYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGFjdGlvblNoZWV0Lm9wdGlvbnMgPSBbXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IG9wdGlvbnMucHJvbXB0TGFiZWxQaG90byB8fCAnRnJvbSBQaG90b3MnIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IG9wdGlvbnMucHJvbXB0TGFiZWxQaWN0dXJlIHx8ICdUYWtlIFBpY3R1cmUnIH0sXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBhY3Rpb25TaGVldC5hZGRFdmVudExpc3RlbmVyKCdvblNlbGVjdGlvbicsIGFzeW5jIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGUuZGV0YWlsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVJbnB1dEV4cGVyaWVuY2Uob3B0aW9ucywgcmVzb2x2ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYUV4cGVyaWVuY2Uob3B0aW9ucywgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFFeHBlcmllbmNlKG9wdGlvbnMsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBwaWNrSW1hZ2VzKF9vcHRpb25zKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1hc3luYy1wcm9taXNlLWV4ZWN1dG9yXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tdWx0aXBsZUZpbGVJbnB1dEV4cGVyaWVuY2UocmVzb2x2ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYyBjYW1lcmFFeHBlcmllbmNlKG9wdGlvbnMsIHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBpZiAoY3VzdG9tRWxlbWVudHMuZ2V0KCdwd2EtY2FtZXJhLW1vZGFsJykpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbWVyYU1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHdhLWNhbWVyYS1tb2RhbCcpO1xuICAgICAgICAgICAgY2FtZXJhTW9kYWwuZmFjaW5nTW9kZSA9XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5kaXJlY3Rpb24gPT09IENhbWVyYURpcmVjdGlvbi5Gcm9udCA/ICd1c2VyJyA6ICdlbnZpcm9ubWVudCc7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbWVyYU1vZGFsKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgY2FtZXJhTW9kYWwuY29tcG9uZW50T25SZWFkeSgpO1xuICAgICAgICAgICAgICAgIGNhbWVyYU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ29uUGhvdG8nLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaG90byA9IGUuZGV0YWlsO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGhvdG8gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgQ2FwYWNpdG9yRXhjZXB0aW9uKCdVc2VyIGNhbmNlbGxlZCBwaG90b3MgYXBwJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBob3RvIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChwaG90byk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGF3YWl0IHRoaXMuX2dldENhbWVyYVBob3RvKHBob3RvLCBvcHRpb25zKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhTW9kYWwuZGlzbWlzcygpO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGNhbWVyYU1vZGFsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjYW1lcmFNb2RhbC5wcmVzZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUlucHV0RXhwZXJpZW5jZShvcHRpb25zLCByZXNvbHZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFVuYWJsZSB0byBsb2FkIFBXQSBFbGVtZW50ICdwd2EtY2FtZXJhLW1vZGFsJy4gU2VlIHRoZSBkb2NzOiBodHRwczovL2NhcGFjaXRvcmpzLmNvbS9kb2NzL3B3YS1lbGVtZW50cy5gKTtcbiAgICAgICAgICAgIHRoaXMuZmlsZUlucHV0RXhwZXJpZW5jZShvcHRpb25zLCByZXNvbHZlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmaWxlSW5wdXRFeHBlcmllbmNlKG9wdGlvbnMsIHJlc29sdmUpIHtcbiAgICAgICAgbGV0IGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI19jYXBhY2l0b3ItY2FtZXJhLWlucHV0Jyk7XG4gICAgICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAoX2EgPSBpbnB1dC5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlQ2hpbGQoaW5wdXQpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoIWlucHV0KSB7XG4gICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgICAgICBpbnB1dC5pZCA9ICdfY2FwYWNpdG9yLWNhbWVyYS1pbnB1dCc7XG4gICAgICAgICAgICBpbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICAgICAgaW5wdXQuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKF9lKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGlucHV0LmZpbGVzWzBdO1xuICAgICAgICAgICAgICAgIGxldCBmb3JtYXQgPSAnanBlZyc7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGUudHlwZSA9PT0gJ2ltYWdlL3BuZycpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gJ3BuZyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpbGUudHlwZSA9PT0gJ2ltYWdlL2dpZicpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gJ2dpZic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnJlc3VsdFR5cGUgPT09ICdkYXRhVXJsJyB8fFxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnJlc3VsdFR5cGUgPT09ICdiYXNlNjQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVzdWx0VHlwZSA9PT0gJ2RhdGFVcmwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFVcmw6IHJlYWRlci5yZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9wdGlvbnMucmVzdWx0VHlwZSA9PT0gJ2Jhc2U2NCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiNjQgPSByZWFkZXIucmVzdWx0LnNwbGl0KCcsJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2U2NFN0cmluZzogYjY0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhbnVwKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2ViUGF0aDogVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgY2xlYW51cCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlucHV0LmFjY2VwdCA9ICdpbWFnZS8qJztcbiAgICAgICAgaW5wdXQuY2FwdHVyZSA9IHRydWU7XG4gICAgICAgIGlmIChvcHRpb25zLnNvdXJjZSA9PT0gQ2FtZXJhU291cmNlLlBob3RvcyB8fFxuICAgICAgICAgICAgb3B0aW9ucy5zb3VyY2UgPT09IENhbWVyYVNvdXJjZS5Qcm9tcHQpIHtcbiAgICAgICAgICAgIGlucHV0LnJlbW92ZUF0dHJpYnV0ZSgnY2FwdHVyZScpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9wdGlvbnMuZGlyZWN0aW9uID09PSBDYW1lcmFEaXJlY3Rpb24uRnJvbnQpIHtcbiAgICAgICAgICAgIGlucHV0LmNhcHR1cmUgPSAndXNlcic7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT09IENhbWVyYURpcmVjdGlvbi5SZWFyKSB7XG4gICAgICAgICAgICBpbnB1dC5jYXB0dXJlID0gJ2Vudmlyb25tZW50JztcbiAgICAgICAgfVxuICAgICAgICBpbnB1dC5jbGljaygpO1xuICAgIH1cbiAgICBtdWx0aXBsZUZpbGVJbnB1dEV4cGVyaWVuY2UocmVzb2x2ZSkge1xuICAgICAgICBsZXQgaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjX2NhcGFjaXRvci1jYW1lcmEtaW5wdXQtbXVsdGlwbGUnKTtcbiAgICAgICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIChfYSA9IGlucHV0LnBhcmVudE5vZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW1vdmVDaGlsZChpbnB1dCk7XG4gICAgICAgIH07XG4gICAgICAgIGlmICghaW5wdXQpIHtcbiAgICAgICAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgICAgIGlucHV0LmlkID0gJ19jYXBhY2l0b3ItY2FtZXJhLWlucHV0LW11bHRpcGxlJztcbiAgICAgICAgICAgIGlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgICAgICBpbnB1dC5oaWRkZW4gPSB0cnVlO1xuICAgICAgICAgICAgaW5wdXQubXVsdGlwbGUgPSB0cnVlO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpbnB1dCk7XG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoX2UpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwaG90b3MgPSBbXTtcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3ByZWZlci1mb3Itb2ZcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0LmZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBpbnB1dC5maWxlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZvcm1hdCA9ICdqcGVnJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUudHlwZSA9PT0gJ2ltYWdlL3BuZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCA9ICdwbmcnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpbGUudHlwZSA9PT0gJ2ltYWdlL2dpZicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCA9ICdnaWYnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHBob3Rvcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdlYlBhdGg6IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc29sdmUoeyBwaG90b3MgfSk7XG4gICAgICAgICAgICAgICAgY2xlYW51cCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXQuYWNjZXB0ID0gJ2ltYWdlLyonO1xuICAgICAgICBpbnB1dC5jbGljaygpO1xuICAgIH1cbiAgICBfZ2V0Q2FtZXJhUGhvdG8ocGhvdG8sIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICBjb25zdCBmb3JtYXQgPSBwaG90by50eXBlLnNwbGl0KCcvJylbMV07XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5yZXN1bHRUeXBlID09PSAndXJpJykge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgICAgICAgICB3ZWJQYXRoOiBVUkwuY3JlYXRlT2JqZWN0VVJMKHBob3RvKSxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKHBob3RvKTtcbiAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkZW5kID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gcmVhZGVyLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVzdWx0VHlwZSA9PT0gJ2RhdGFVcmwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVXJsOiByLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0U3RyaW5nOiByLnNwbGl0KCcsJylbMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgY2hlY2tQZXJtaXNzaW9ucygpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnIHx8ICFuYXZpZ2F0b3IucGVybWlzc2lvbnMpIHtcbiAgICAgICAgICAgIHRocm93IHRoaXMudW5hdmFpbGFibGUoJ1Blcm1pc3Npb25zIEFQSSBub3QgYXZhaWxhYmxlIGluIHRoaXMgYnJvd3NlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvUGVybWlzc2lvbnMvcXVlcnlcbiAgICAgICAgICAgIC8vIHRoZSBzcGVjaWZpYyBwZXJtaXNzaW9ucyB0aGF0IGFyZSBzdXBwb3J0ZWQgdmFyaWVzIGFtb25nIGJyb3dzZXJzIHRoYXQgaW1wbGVtZW50IHRoZVxuICAgICAgICAgICAgLy8gcGVybWlzc2lvbnMgQVBJLCBzbyB3ZSBuZWVkIGEgdHJ5L2NhdGNoIGluIGNhc2UgJ2NhbWVyYScgaXMgaW52YWxpZFxuICAgICAgICAgICAgY29uc3QgcGVybWlzc2lvbiA9IGF3YWl0IHdpbmRvdy5uYXZpZ2F0b3IucGVybWlzc2lvbnMucXVlcnkoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdjYW1lcmEnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGNhbWVyYTogcGVybWlzc2lvbi5zdGF0ZSxcbiAgICAgICAgICAgICAgICBwaG90b3M6ICdncmFudGVkJyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgICAgICB0aHJvdyB0aGlzLnVuYXZhaWxhYmxlKCdDYW1lcmEgcGVybWlzc2lvbnMgYXJlIG5vdCBhdmFpbGFibGUgaW4gdGhpcyBicm93c2VyJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgcmVxdWVzdFBlcm1pc3Npb25zKCkge1xuICAgICAgICB0aHJvdyB0aGlzLnVuaW1wbGVtZW50ZWQoJ05vdCBpbXBsZW1lbnRlZCBvbiB3ZWIuJyk7XG4gICAgfVxufVxuY29uc3QgQ2FtZXJhID0gbmV3IENhbWVyYVdlYigpO1xuZXhwb3J0IHsgQ2Ft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
